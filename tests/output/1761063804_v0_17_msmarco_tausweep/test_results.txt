
(.venv) lorenzo@lorenzo-tuxedo:/datadisk/publish/pyarrowspace$ python tests/test_4_msmarco_tau_sweep.py 
Error loading BeIR dataset: Dataset scripts are no longer supported, but found msmarco.py
Falling back to huggingface MS MARCO dataset...
Loaded MS MARCO validation: 10047 samples
Total passages: 81039
Total queries: 10047
Queries with positives: 9706
Loading embedding model: sentence-transformers/all-mpnet-base-v2
Embedding corpus...
Query embeddings shape: (10047, 768)
Dataset size: 81039 | Evaluation queries: 50
Building ArrowSpace on corpus subset...
Sample embedding shape: (768,)
[pyarrowspace] Convert pyarray2 and Vec<Vec>
[pyarrowspace] items shape: (81039, 768)
[pyarrowspace] items[0][:5]: [3.425135374069214, -0.18750563263893127, 0.08075494319200516, 3.9714858531951904, -2.190162420272827]
[pyarrowspace] NaNs: 0, Infs: 0
[pyarrowspace] Building from rows
[pyarrowspace] built ArrowSpace: nitems=81039, nfeatures=768, lambdas_len=81039
ArrowSpace build time: 336.945320 seconds

================================================================================
RUNNING TAU SWEEP EVALUATION
================================================================================

================================================================================
Evaluating mode: COSINE (tau=1.0)
================================================================================
Running 50 queries...
  Processed 0/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.016707
[pyarrowspace] search: qlen=768, lambda_q=0.007632
[pyarrowspace] search: qlen=768, lambda_q=0.008263
[pyarrowspace] search: qlen=768, lambda_q=0.040965
[pyarrowspace] search: qlen=768, lambda_q=0.009010
[pyarrowspace] search: qlen=768, lambda_q=0.008625
[pyarrowspace] search: qlen=768, lambda_q=0.007451
[pyarrowspace] search: qlen=768, lambda_q=0.018170
[pyarrowspace] search: qlen=768, lambda_q=0.121199
[pyarrowspace] search: qlen=768, lambda_q=0.009950
  Processed 10/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.024258
[pyarrowspace] search: qlen=768, lambda_q=0.032637
[pyarrowspace] search: qlen=768, lambda_q=0.011475
[pyarrowspace] search: qlen=768, lambda_q=0.052624
[pyarrowspace] search: qlen=768, lambda_q=0.007043
[pyarrowspace] search: qlen=768, lambda_q=0.007680
[pyarrowspace] search: qlen=768, lambda_q=0.007141
[pyarrowspace] search: qlen=768, lambda_q=0.006915
[pyarrowspace] search: qlen=768, lambda_q=0.008544
[pyarrowspace] search: qlen=768, lambda_q=0.092020
  Processed 20/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.006781
[pyarrowspace] search: qlen=768, lambda_q=0.032909
[pyarrowspace] search: qlen=768, lambda_q=0.016524
[pyarrowspace] search: qlen=768, lambda_q=0.027122
[pyarrowspace] search: qlen=768, lambda_q=0.006778
[pyarrowspace] search: qlen=768, lambda_q=0.026076
[pyarrowspace] search: qlen=768, lambda_q=0.008498
[pyarrowspace] search: qlen=768, lambda_q=0.008221
[pyarrowspace] search: qlen=768, lambda_q=0.071464
[pyarrowspace] search: qlen=768, lambda_q=0.006271
  Processed 30/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.028244
[pyarrowspace] search: qlen=768, lambda_q=0.031995
[pyarrowspace] search: qlen=768, lambda_q=0.059566
[pyarrowspace] search: qlen=768, lambda_q=0.055320
[pyarrowspace] search: qlen=768, lambda_q=0.006048
[pyarrowspace] search: qlen=768, lambda_q=0.006031
[pyarrowspace] search: qlen=768, lambda_q=0.006938
[pyarrowspace] search: qlen=768, lambda_q=0.006700
[pyarrowspace] search: qlen=768, lambda_q=0.033220
[pyarrowspace] search: qlen=768, lambda_q=0.009408
  Processed 40/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.006459
[pyarrowspace] search: qlen=768, lambda_q=0.006940
[pyarrowspace] search: qlen=768, lambda_q=0.027887
[pyarrowspace] search: qlen=768, lambda_q=0.005871
[pyarrowspace] search: qlen=768, lambda_q=0.006446
[pyarrowspace] search: qlen=768, lambda_q=0.041673
[pyarrowspace] search: qlen=768, lambda_q=0.008495
[pyarrowspace] search: qlen=768, lambda_q=0.007692
[pyarrowspace] search: qlen=768, lambda_q=0.006501
[pyarrowspace] search: qlen=768, lambda_q=0.007048

Results for cosine (tau=1.0):
  Recall@10: 0.9100
  MRR:       0.5107
  nDCG@10:   0.6027

================================================================================
Evaluating mode: TAUMODE (tau=0.62)
================================================================================
Running 50 queries...
  Processed 0/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.016707
[pyarrowspace] search: qlen=768, lambda_q=0.007632
[pyarrowspace] search: qlen=768, lambda_q=0.008263
[pyarrowspace] search: qlen=768, lambda_q=0.040965
[pyarrowspace] search: qlen=768, lambda_q=0.009010
[pyarrowspace] search: qlen=768, lambda_q=0.008625
[pyarrowspace] search: qlen=768, lambda_q=0.007451
[pyarrowspace] search: qlen=768, lambda_q=0.018170
[pyarrowspace] search: qlen=768, lambda_q=0.121199
[pyarrowspace] search: qlen=768, lambda_q=0.009950
  Processed 10/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.024258
[pyarrowspace] search: qlen=768, lambda_q=0.032637
[pyarrowspace] search: qlen=768, lambda_q=0.011475
[pyarrowspace] search: qlen=768, lambda_q=0.052624
[pyarrowspace] search: qlen=768, lambda_q=0.007043
[pyarrowspace] search: qlen=768, lambda_q=0.007680
[pyarrowspace] search: qlen=768, lambda_q=0.007141
[pyarrowspace] search: qlen=768, lambda_q=0.006915
[pyarrowspace] search: qlen=768, lambda_q=0.008544
[pyarrowspace] search: qlen=768, lambda_q=0.092020
  Processed 20/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.006781
[pyarrowspace] search: qlen=768, lambda_q=0.032909
[pyarrowspace] search: qlen=768, lambda_q=0.016524
[pyarrowspace] search: qlen=768, lambda_q=0.027122
[pyarrowspace] search: qlen=768, lambda_q=0.006778
[pyarrowspace] search: qlen=768, lambda_q=0.026076
[pyarrowspace] search: qlen=768, lambda_q=0.008498
[pyarrowspace] search: qlen=768, lambda_q=0.008221
[pyarrowspace] search: qlen=768, lambda_q=0.071464
[pyarrowspace] search: qlen=768, lambda_q=0.006271
  Processed 30/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.028244
[pyarrowspace] search: qlen=768, lambda_q=0.031995
[pyarrowspace] search: qlen=768, lambda_q=0.059566
[pyarrowspace] search: qlen=768, lambda_q=0.055320
[pyarrowspace] search: qlen=768, lambda_q=0.006048
[pyarrowspace] search: qlen=768, lambda_q=0.006031
[pyarrowspace] search: qlen=768, lambda_q=0.006938
[pyarrowspace] search: qlen=768, lambda_q=0.006700
[pyarrowspace] search: qlen=768, lambda_q=0.033220
[pyarrowspace] search: qlen=768, lambda_q=0.009408
  Processed 40/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.006459
[pyarrowspace] search: qlen=768, lambda_q=0.006940
[pyarrowspace] search: qlen=768, lambda_q=0.027887
[pyarrowspace] search: qlen=768, lambda_q=0.005871
[pyarrowspace] search: qlen=768, lambda_q=0.006446
[pyarrowspace] search: qlen=768, lambda_q=0.041673
[pyarrowspace] search: qlen=768, lambda_q=0.008495
[pyarrowspace] search: qlen=768, lambda_q=0.007692
[pyarrowspace] search: qlen=768, lambda_q=0.006501
[pyarrowspace] search: qlen=768, lambda_q=0.007048

Results for taumode (tau=0.62):
  Recall@10: 0.8900
  MRR:       0.5132
  nDCG@10:   0.5988

================================================================================
Evaluating mode: EXTRA-TAUMODE (tau=0.42)
================================================================================
Running 50 queries...
  Processed 0/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.016707
[pyarrowspace] search: qlen=768, lambda_q=0.007632
[pyarrowspace] search: qlen=768, lambda_q=0.008263
[pyarrowspace] search: qlen=768, lambda_q=0.040965
[pyarrowspace] search: qlen=768, lambda_q=0.009010
[pyarrowspace] search: qlen=768, lambda_q=0.008625
[pyarrowspace] search: qlen=768, lambda_q=0.007451
[pyarrowspace] search: qlen=768, lambda_q=0.018170
[pyarrowspace] search: qlen=768, lambda_q=0.121199
[pyarrowspace] search: qlen=768, lambda_q=0.009950
  Processed 10/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.024258
[pyarrowspace] search: qlen=768, lambda_q=0.032637
[pyarrowspace] search: qlen=768, lambda_q=0.011475
[pyarrowspace] search: qlen=768, lambda_q=0.052624
[pyarrowspace] search: qlen=768, lambda_q=0.007043
[pyarrowspace] search: qlen=768, lambda_q=0.007680
[pyarrowspace] search: qlen=768, lambda_q=0.007141
[pyarrowspace] search: qlen=768, lambda_q=0.006915
[pyarrowspace] search: qlen=768, lambda_q=0.008544
[pyarrowspace] search: qlen=768, lambda_q=0.092020
  Processed 20/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.006781
[pyarrowspace] search: qlen=768, lambda_q=0.032909
[pyarrowspace] search: qlen=768, lambda_q=0.016524
[pyarrowspace] search: qlen=768, lambda_q=0.027122
[pyarrowspace] search: qlen=768, lambda_q=0.006778
[pyarrowspace] search: qlen=768, lambda_q=0.026076
[pyarrowspace] search: qlen=768, lambda_q=0.008498
[pyarrowspace] search: qlen=768, lambda_q=0.008221
[pyarrowspace] search: qlen=768, lambda_q=0.071464
[pyarrowspace] search: qlen=768, lambda_q=0.006271
  Processed 30/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.028244
[pyarrowspace] search: qlen=768, lambda_q=0.031995
[pyarrowspace] search: qlen=768, lambda_q=0.059566
[pyarrowspace] search: qlen=768, lambda_q=0.055320
[pyarrowspace] search: qlen=768, lambda_q=0.006048
[pyarrowspace] search: qlen=768, lambda_q=0.006031
[pyarrowspace] search: qlen=768, lambda_q=0.006938
[pyarrowspace] search: qlen=768, lambda_q=0.006700
[pyarrowspace] search: qlen=768, lambda_q=0.033220
[pyarrowspace] search: qlen=768, lambda_q=0.009408
  Processed 40/50 queries
[pyarrowspace] search: qlen=768, lambda_q=0.006459
[pyarrowspace] search: qlen=768, lambda_q=0.006940
[pyarrowspace] search: qlen=768, lambda_q=0.027887
[pyarrowspace] search: qlen=768, lambda_q=0.005871
[pyarrowspace] search: qlen=768, lambda_q=0.006446
[pyarrowspace] search: qlen=768, lambda_q=0.041673
[pyarrowspace] search: qlen=768, lambda_q=0.008495
[pyarrowspace] search: qlen=768, lambda_q=0.007692
[pyarrowspace] search: qlen=768, lambda_q=0.006501
[pyarrowspace] search: qlen=768, lambda_q=0.007048

Results for extra-taumode (tau=0.42):
  Recall@10: 0.8600
  MRR:       0.5006
  nDCG@10:   0.5790

================================================================================
COMPARATIVE RESULTS - TAU SWEEP
================================================================================
Dataset: MS MARCO (BeIR)
Dataset size: 81039
Evaluated queries: 50

Mode                 Tau      Recall@10    MRR          nDCG@10     
--------------------------------------------------------------------------------
cosine               1.00     0.9100       0.5107       0.6027      
taumode              0.62     0.8900       0.5132       0.5988      
extra-taumode        0.42     0.8600       0.5006       0.5790      
================================================================================

================================================================================
RELATIVE IMPROVEMENTS vs COSINE BASELINE (tau=1.0)
================================================================================

Mode                 Tau      Recall@10       MRR             nDCG@10        
--------------------------------------------------------------------------------
taumode              0.62              -2.20%          +0.49%          -0.64%
extra-taumode        0.42              -5.49%          -1.98%          -3.93%
================================================================================

================================================================================
STATISTICAL SIGNIFICANCE (paired t-test vs cosine)
================================================================================

TAUMODE (tau=0.62) vs COSINE:
------------------------------------------------------------
Recall@10:  t=-1.0000, p=0.322223, Significant: ✗ No
MRR:        t= 0.1833, p=0.855313, Significant: ✗ No
nDCG@10:    t=-0.3281, p=0.744265, Significant: ✗ No

EXTRA-TAUMODE (tau=0.42) vs COSINE:
------------------------------------------------------------
Recall@10:  t=-1.6977, p=0.095898, Significant: ✗ No
MRR:        t=-0.6488, p=0.519524, Significant: ✗ No
nDCG@10:    t=-1.4801, p=0.145240, Significant: ✗ No

================================================================================

================================================================================
BEST TAU MODE PER METRIC
================================================================================
Recall@10: cosine (tau=1.0) = 0.9100
MRR:       taumode (tau=0.62) = 0.5132
nDCG@10:   cosine (tau=1.0) = 0.6027
================================================================================

✓ Results saved to: beir_tau_sweep_results.json